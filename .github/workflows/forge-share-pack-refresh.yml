name: Forge Share Pack Refresh (Validate Only)

# NOTE: This workflow validates Share Pack generation but does NOT commit.
# The forge-portal-pages.yml workflow generates fresh indices before deploy,
# so auto-committing here is redundant and fails with branch protection.
#
# This workflow serves as a validation check only.

on:
  push:
    branches: ["main"]
    paths:
      - "The Forge/forge/**"
      - "The Forge/myfi/**"
      - ".github/workflows/forge-share-pack-refresh.yml"

permissions:
  contents: read

jobs:
  validate:
    name: Validate Share Pack Generation
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: "20"

      - name: Generate Share Pack (validation)
        run: |
          echo "=== Generating Share Pack (validation mode) ==="
          node "The Forge/forge/ops/scripts/refresh-share-pack.mjs"
          echo "=== Share Pack generated successfully ==="

      - name: Validate outputs exist
        run: |
          if [ -f "The Forge/forge/exports/share-pack/share-pack.index.json" ]; then
            echo "✅ share-pack.index.json exists"
          else
            echo "❌ share-pack.index.json missing"
            exit 1
          fi

          if [ -f "The Forge/forge/exports/share-pack/work-orders.index.json" ]; then
            echo "✅ work-orders.index.json exists"
          else
            echo "❌ work-orders.index.json missing"
            exit 1
          fi

          echo ""
          echo "============================================"
          echo "SHARE PACK VALIDATION COMPLETE"
          echo "============================================"
          echo ""
          echo "NOTE: Share Pack files are generated at deploy time"
          echo "by forge-portal-pages.yml (no commit needed here)."
          echo "============================================"
