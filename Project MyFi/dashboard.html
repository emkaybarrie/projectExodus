<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <!-- updated -->
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Vitals HUD</title>

  <!-- Embedded styles for slide router + nav arrows -->
  <style>
    /* Disable native long-press inside Vitals */
    #vitals-root.no-select-callout {
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    #vitals-root.no-select-callout img { -webkit-user-drag: none; user-drag: none; }
    #vitals-root .allow-select, #vitals-root [data-allow-context],
    #vitals-root .allow-select *, #vitals-root [data-allow-context] * {
      -webkit-user-select: text !important; user-select: text !important; -webkit-touch-callout: default !important;
    }

    /* ---------- FULL-SCREEN SLIDE ROUTER ---------- */
    html, body, #app { height: 100%; }
    body { overscroll-behavior: none; }
    #screen-stage {
      position: fixed; inset: 0; overflow: hidden; z-index: 1;
    }
    .screen {
      position: absolute; inset: 0;
      will-change: transform, opacity;
      touch-action: pan-y pan-x;
      pointer-events: none;
      opacity: 0;
      transform: translate3d(0,0,0);
      background: transparent;
    }
    .screen.screen--active { pointer-events: auto; opacity: 1; }
    .screen.animating {
      transition: transform 300ms cubic-bezier(.22,.8,.22,1), opacity 300ms ease;
    }
    .screen.from-up    { transform: translate3d(0,-100%,0); opacity: 1; }
    .screen.from-down  { transform: translate3d(0, 100%,0); opacity: 1; }
    .screen.from-left  { transform: translate3d(-100%,0,0); opacity: 1; }
    .screen.from-right { transform: translate3d( 100%,0,0); opacity: 1; }
    .screen.to-up    { transform: translate3d(0,-100%,0); }
    .screen.to-down  { transform: translate3d(0, 100%,0); }
    .screen.to-left  { transform: translate3d(-100%,0,0); }
    .screen.to-right { transform: translate3d( 100%,0,0); }

    /* ---------- EDGE NAV (compact glass chevrons) ---------- */
    .myfi-nav-mount { position: fixed; inset: 0; pointer-events: none; z-index: 60; }
    .myfi-nav { pointer-events: none; }
    .myfi-nav--edge { position: fixed; inset: 0; }

    .myfi-nav--edge.nav-hidden { opacity: 0; pointer-events: none; transition: opacity .18s ease; }
    .myfi-nav--edge:not(.nav-hidden) { opacity: 1; transition: opacity .18s ease; }

    .myfi-nav-btn {
      position: absolute;
      width: 26px; height: 26px;
      border-radius: 10px;
      display: grid; place-items: center;
      pointer-events: auto;
      border: 1px solid rgba(220,230,255,.14);
      background: linear-gradient(180deg, rgba(60,70,100,.35), rgba(30,35,60,.25));
      backdrop-filter: blur(8px) saturate(120%);
      box-shadow: 0 6px 18px rgba(0,0,0,.22), inset 0 0 0 1px rgba(255,255,255,.06);
      opacity: .55; color: #fff;
      transition: opacity .12s ease, background .12s ease, box-shadow .12s ease;
    }
    .myfi-nav-btn:hover { opacity: .85; }
    .myfi-nav-btn:active { opacity: 1; }

    .myfi-nav--edge .myfi-nav-btn[data-dir="up"]    { top: 8px;    left: 50%; transform: translate(-50%, 0); }
    .myfi-nav--edge .myfi-nav-btn[data-dir="down"]  { bottom: 8px; left: 50%; transform: translate(-50%, 0); }
    .myfi-nav--edge .myfi-nav-btn[data-dir="left"]  { left: 8px;   top: 50%;  transform: translate(0, -50%); }
    .myfi-nav--edge .myfi-nav-btn[data-dir="right"] { right: 8px;  top: 50%;  transform: translate(0, -50%); }

    .myfi-hidden { display: none !important; }

    .myfi-nav-btn::before {
      content: ""; display: block; width: 0; height: 0;
      filter: drop-shadow(0 1px 1px rgba(0,0,0,.25));
    }
    .myfi-nav-btn[data-dir="left"]::before  { border-style: solid; border-width: 6px 9px 6px 0;  border-color: transparent rgba(255,255,255,.9) transparent transparent; }
    .myfi-nav-btn[data-dir="right"]::before { border-style: solid; border-width: 6px 0 6px 9px;  border-color: transparent transparent transparent rgba(255,255,255,.9); }
    .myfi-nav-btn[data-dir="up"]::before    { border-style: solid; border-width: 0 6px 9px 6px;  border-color: transparent transparent rgba(255,255,255,.9) transparent; }
    .myfi-nav-btn[data-dir="down"]::before  { border-style: solid; border-width: 9px 6px 0 6px;  border-color: rgba(255,255,255,.9) transparent transparent transparent; }
  </style>

  <!-- App scripts -->
  <script type="module" src="js/dashboard.js" defer></script>
  <script type="module" src="js/essenceMenu.js" defer></script>

  <script type="module">
  import { installInteractionGuards } from './js/interactionGuards.js';
  installInteractionGuards(document);
</script>

  <!-- Styles -->
  <link rel="stylesheet" href="css/splash.css" />
  <link rel="stylesheet" href="css/general.css" />
  <link rel="stylesheet" href="css/tour.css" />
  <link rel="stylesheet" href="css/vitals.css" />
  <link rel="stylesheet" href="screenPlaceholders.css" />
  <link rel="stylesheet" href="css/modal.css" />
  <link rel="stylesheet" href="css/pwa.css" />
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600&family=Crimson+Pro:wght@400;600&display=swap" rel="stylesheet">
  <link rel="manifest" href="manifest.json">
</head>
<body>

<div id="app" class="app-root app-no-context">

  <!-- Install Banner -->
  <div id="installBanner" class="install-banner" style="display: none;">
    <span>üì≤ Install MyFi</span>
    <div class="buttons">
      <button id="installBtn">Install</button>
      <button id="dismissInstall" class="dismiss-btn" title="Dismiss">‚úñ</button>
    </div>
  </div>

  <!-- ===== Slide Stage (wrap screens here) ===== -->
  <div id="screen-stage" aria-live="polite">

    <!-- Vitals (hub) -->
    <div id="vitals-root" class="vitals-container screen screen--active no-select-callout" data-screen="vitals" aria-current="page">
      <div id="background-layer"></div>
      <div class="starfield-overlay"></div>

      <div class="topbar" role="region" aria-label="Vitals header">
        <h1 id="header-title" class="alias" title="VITALS">VITALS</h1>
        <div class="topbar-actions" id="headerActions">
          <button class="btn btn-icon music-btn" type="button"
                  data-action="toggle-music"
                  aria-label="Mute music"
                  aria-pressed="true"
                  title="Toggle music">
            <span class="music-btn__icon" aria-hidden="true">üéµ</span>
            <span class="music-btn__label">Music On</span>
          </button>
          <button class="icon-circle" id="help-btn" title="Help" aria-label="Help">?</button>
          <button class="icon-circle" id="settings-btn" title="Settings" aria-label="Settings">‚öôÔ∏è</button>

          <!-- New: sandwich button + popover (hidden unless collapsed) -->
          <button class="icon-circle more" id="btnMore" title="More" aria-haspopup="menu" aria-expanded="false" style="display:none;">‚ò∞</button>
          <div id="moreMenu" class="more-menu" role="menu" hidden>
            <button role="menuitem" data-proxy=".music-btn">üéµ Music</button>
            <button role="menuitem" data-proxy="#help-btn">? Help</button>
            <button role="menuitem" data-proxy="#settings-btn">‚öôÔ∏è Settings</button>
          </div>
        </div>
      </div>

      <div class="top-section">
        <div class="portrait-wrapper">
          <img src="./assets/portraits/default.png" alt="Avatar Portrait" class="portrait" id="player-portrait" />
          <div class="level-pill" id="player-level" hidden>1</div>
        </div>

        <div class="vitals-bars">
          <div id="vital-health">
            <div class="bar health">
              <span class="bar-label">Health</span>
              <div class="bar-fill" style="width: 0%;"></div>
              <span class="bar-value">0 / 0</span>
              <span class="bar-surplus" aria-hidden="true"></span>
            </div>
          </div>
          <div id="vital-mana">
            <div class="bar mana">
              <span class="bar-label">Mana</span>
              <div class="bar-fill" style="width: 0%;"></div>
              <span class="bar-value">0 / 0</span>
              <span class="bar-surplus" aria-hidden="true"></span>
            </div>
          </div>
        </div>
      </div>

      <div id="vital-stamina">
        <div class="bar stamina">
          <span class="bar-label">Stamina</span>
          <div class="bar-fill" style="width: 0%;"></div>
          <span class="bar-value">0 / 0</span>
          <span class="bar-surplus" aria-hidden="true"></span>
        </div>
      </div>

      <div class="vitals-toprow">
        <div class="mode-engrave" id="mode-engrave" role="tablist" aria-label="View mode">
          <button class="mode-btn" data-mode="daily"   role="tab" aria-selected="false">Daily</button>
          <button class="mode-btn" data-mode="weekly"  role="tab" aria-selected="false">Weekly</button>
          <button class="mode-btn" data-mode="monthly" role="tab" aria-selected="false">Monthly</button>
        </div>
        <div class="vitals-total" id="vitals-total" aria-live="polite"></div>
      </div>

      <div class="skills-row">Skills
        <div class="skill-slot locked">üîí</div>
        <div class="skill-slot locked">üîí</div>
        <div class="skill-slot locked">üîí</div>
        <div class="skill-slot locked">üîí</div>
      </div>

      <div class="update-log-box">
        <div class="update-log">
          <h2>UPDATE LOG <button class="hx-expand scrollable" id="btn-expand-update" title="View all history" aria-label="View all history">‚ÜóÔ∏é</button></h2>
          <ul id="update-log-list"></ul>
        </div>

        <div class="section-divider"></div>

        <div class="recently-locked">
          <h2>RECENTLY LOCKED <button class="hx-expand scrollable" id="btn-expand-locked" title="View all history" aria-label="View all history">‚ÜóÔ∏é</button></h2>
          <ul id="recently-locked-list"></ul>
        </div>
      </div>

      <div class="hud-footer">
        <div id="vital-essence">
          <div class="bar essence">
            <span class="bar-label">Essence</span>
            <div class="bar-fill" style="width: 0%;"></div>
            <span class="bar-value">0 / 0</span>
            <span class="bar-surplus" aria-hidden="true"></span>
          </div>
        </div>

        <div class="actions">
          <button class="side-btn" id="left-btn" title="Time Mode">üåÄ</button>
          <button class="main-btn" id="essence-btn" title="Use Essence"></button>
          <button class="side-btn" id="right-btn" title="Finances">üìú</button>
        </div>
      </div>
    </div>

    <!-- Products / Resources - Up -->
    <div id="screen-products" class="screen" data-screen="products" aria-hidden="true">
      <div class="placeholder" style="--mockup-url: url('./assets/mockups/resources.png')">
        <div class="placeholder-content">
          <h1>Resources</h1>
          <h2>(Coming Soon)</h2>
          <p>Gain financial insight and connect to partner products/services.</p>
          <ul>
            <li>Personalised Financial Report</li>
            <li>Budget & Spending Insights</li>
            <li>Partner Products & Services</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Quests - Left -->
    <div id="screen-quests" class="screen" data-screen="quests" aria-hidden="true">
      <div class="placeholder" style="--mockup-url: url('./assets/mockups/quests.png')">
        <div class="placeholder-content">
          <h1>Quests</h1>
          <h2>(Coming Soon)</h2>
          <p>Goals and challenges that build habits.</p>
          <ul>
            <li>Active & Completed Quests</li>
            <li>Goal Progress Tracking</li>
            <li>Streaks & Rewards</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Avatar - Right -->
    <div id="screen-avatar" class="screen" data-screen="avatar" aria-hidden="true">
      <div class="placeholder" style="--mockup-url: url('./assets/mockups/avatar.png')">
        <div class="placeholder-content">
          <h1>Avatar</h1>
          <h2>(Coming Soon)</h2>
          <p>Customise, level up, and equip perks.</p>
          <ul>
            <li>Stats & Level Progress</li>
            <li>Perks, Gear & Cosmetics</li>
            <li>Skill Tree & Artifacts</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- The Badlands - Down -->
    <div id="screen-myana" class="screen" data-screen="myana" aria-hidden="true">
      <div class="placeholder" style="--mockup-url: url('./assets/mockups/badlands.png')">
        <div class="placeholder-content">
          <h1>The Badlands</h1>
          <h2>(Coming Soon)</h2>
          <p>The 2D rogue-lite where your prep is tested and rewarded.</p>
          <ul>
            <li>Explore the City of Myana</li>
            <li>Brave the Badlands</li>
            <li>Compete & Earn Rewards</li>
          </ul>
        </div>
      </div>
    </div>

  </div><!-- /#screen-stage -->

  <!-- Nav arrows mount -->
  <div id="myfiNavMount" class="myfi-nav-mount" aria-hidden="true"></div>

  <!-- Modal (kept) -->
  <div class="modal-backdrop" id="appModalBackdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" role="document">
      <nav class="modal__menu" aria-label="Settings menu">
        <h3>Actions</h3>
        <div id="modalMenu"></div>
      </nav>
      <section class="modal__body">
        <header class="modal__header">
          <button class="btn modal__back" type="button" aria-label="Back">Back</button>
          <div class="modal__title" id="modalTitle">Menu</div>
        </header>
        <div class="modal__content scrollable" id="modalContent"></div>
        <footer class="modal__footer" id="modalFooter">
          <button class="btn" data-action="close">Close</button>
        </footer>
      </section>
    </div>
  </div>

</div><!-- /#app -->

<!-- Auto-wire Update Log + History buttons (unchanged) -->
<script type="module">
  import { autoInitUpdateLog, autoInitHistoryButtons } from './js/hud/modules/vitals.js';
  autoInitUpdateLog();
  autoInitHistoryButtons();
</script>

<!-- Viewport + footer height shims (added) -->
<script>
(function () {
  const root = document.documentElement;

  function setVH() {
    const h = (window.visualViewport ? Math.round(window.visualViewport.height) : window.innerHeight);
    root.style.setProperty('--app-vh', h + 'px');
  }

  function setFooterSpace() {
    const footer = document.querySelector('.hud-footer');
    if (!footer) return;
    const h = Math.ceil(footer.getBoundingClientRect().height);
    root.style.setProperty('--hud-footer-h', h + 'px');
  }

  function recalc() { setVH(); setFooterSpace(); }
  recalc();

  window.addEventListener('resize', recalc, { passive: true });
  window.addEventListener('orientationchange', recalc, { passive: true });
  document.addEventListener('visibilitychange', () => !document.hidden && recalc(), { passive: true });
  if (window.visualViewport) {
    window.visualViewport.addEventListener('resize', recalc, { passive: true });
    window.visualViewport.addEventListener('scroll', recalc, { passive: true });
  }
})();
</script>

</body>
</html>
