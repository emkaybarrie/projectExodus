<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Project MyFi – Start</title>

  <!-- Lottie -->
  <script src="https://unpkg.com/lottie-web@5.12.2/build/player/lottie.min.js"></script>

  <style>
    html, body {
      margin: 0; padding: 0;
      width: 100%; height: 100%;
      background: #000;
      overflow: hidden;
      font-family: system-ui, sans-serif;
    }
    .start {
      position: relative;
      inset: 0;
      width: 100vw; height: 100vh;
      background:#000;
    }
    .start__video,
    .start__still,
    .start__lottie {
      position: absolute;
      inset: 0;
      width: 100%; height: 100%;
      object-fit: cover;
    }
    .start__still,
    .start__lottie,
    .start__cta {
      opacity: 0;
      transition: opacity .6s ease;
    }
    .start__cta {
      position:absolute;
      left:50%; bottom:7vh;
      transform:translateX(-50%);
      padding:.8rem 1.2rem;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(20,24,44,.35);
      color:#fff; font-size:1.05rem;
      letter-spacing:.4px;
      backdrop-filter:blur(6px);
      -webkit-backdrop-filter:blur(6px);
      cursor:pointer;
    }
    .start--still .start__still { opacity: 1; }
    .start--still .start__lottie { opacity: .8; }
    .start--cta   .start__cta   { opacity: 1; }
    .start--fadeout {
      transition: opacity .6s ease;
      opacity: 0;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div id="start-root" class="start">
    <!-- Intro video (B) -->
    <video id="introVid" playsinline muted preload="auto" class="start__video">
      <source src="./assets/intro.webm" type="video/webm" />
      <source src="./assets/intro.mp4" type="video/mp4" />
    </video>

    <!-- Final still (must match last frame of intro) -->
    <img id="startStill" class="start__still" src="./assets/start/start_still.png" alt="" aria-hidden="true"/>

    <!-- Lottie loop overlay (A) -->
    <div id="loopAnim" class="start__lottie" aria-hidden="true"></div>

    <!-- Tap to Start CTA -->
    <button id="tapToStart" class="start__cta" type="button">Tap to Start</button>
  </div>

  <script>
    (function () {
      const root = document.getElementById('start-root');
      const vid  = document.getElementById('introVid');
      const still= document.getElementById('startStill');
      const cta  = document.getElementById('tapToStart');
      const loopContainer = document.getElementById('loopAnim');

      // Prepare Lottie (subtle loop overlay)
      const loopAnim = lottie.loadAnimation({
        container: loopContainer,
        renderer: 'svg',
        loop: true,
        autoplay: false,
        path: './assets/start/pulse-embers.json'   // <-- we’ll create this next
      });

      // Autoplay intro
      const startIntro = () => vid.play().catch(()=>{});
      if (document.visibilityState === 'visible') startIntro();
      document.addEventListener('visibilitychange', () => {
        if (document.visibilityState === 'visible' && vid.currentTime === 0) startIntro();
      });

      // When intro ends, reveal still + loop + CTA
      const reveal = () => {
        root.classList.add('start--still');
        loopAnim.goToAndPlay(0, true);
        root.classList.add('start--cta');
      };
      vid.addEventListener('ended', reveal);
      vid.addEventListener('error', reveal);

      // If video fails to autoplay → skip directly
      root.addEventListener('click', () => {
        if (!root.classList.contains('start--still')) {
          vid.pause(); reveal();
        }
      }, { once: true });

      // Tap to Start → fadeout → redirect to auth.html
      cta.addEventListener('click', (e) => {
        e.stopPropagation();
        root.classList.add('start--fadeout');
        setTimeout(() => {
          window.location.href = "auth.html";
        }, 600); // match fade duration
      });
    })();
  </script>
</body>
</html>
