<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Project MyFi</title>
  <style>
    html,body{height:100%;margin:0;background:#000;overflow:hidden}
    .stage{position:fixed;inset:0}
    .layer{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}
    /* still */
    .still{z-index:1;filter:none}
    /* intro on top of still */
    #intro{z-index:2}
    /* overlays sit above still after intro */
    .motion{z-index:3;mix-blend-mode:screen;opacity:0;transition:opacity .6s ease}
    .ready .motion{opacity:.95} /* tweak .85–1.0 */
    .pulse {z-index:4; mix-blend-mode:screen; }             /* black becomes transparent-ish glow */
    .ready .pulse{opacity:.95} /* tweak .85–1.0 */
    /* CTA */
    .cta{
      position:absolute;left:50%;bottom:28px;transform:translateX(-50%);
      z-index:4;padding:.65rem 1.1rem;border:1px solid rgba(255,255,255,.2);
      border-radius:12px;background:rgba(10,12,18,.55);backdrop-filter:saturate(120%) blur(4px);
      color:#fff;font:600 16px/1.2 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      opacity:0;transition:opacity .4s ease;pointer-events:auto
    }
    .ready .cta{opacity:1}
    /* small helper for fade-out on tap */
    .leaving{animation:fadeout .35s ease forwards}
    @keyframes fadeout{to{opacity:0;transform:translateX(-50%) translateY(2px)}}
  </style>
</head>
<body>
  <main class="stage">

    <!-- Background still (final locked frame) -->
    <img id="still" class="layer still" src="./assets/start/start_still.png" alt="">

    <!-- Flashy intro (includes the white flash that masks the match cut) -->
    <video id="intro" class="layer" playsinline muted preload="auto">
      <source src="./assets/start/intro-start_HD.webm" type="video/webm" />
    </video>

    <!-- Loop overlays (luminous on black; will be revealed after intro) -->
    <video id="fire" class="layer motion" playsinline muted loop preload="auto">
      <source src="./assets/start/fire.webm" type="video/webm" />
    </video>

    <video id="smoke" class="layer motion" playsinline muted loop preload="auto">
      <source src="./assets/start/smoke.webm" type="video/webm" />
    </video>
    <video id="rays" class="layer motion" playsinline muted loop preload="auto">
      <source src="./assets/start/rays.webm" type="video/webm" />
    </video>

    <!-- Painterly pulse overlay (this is the new video you asked for) -->
    <video id="pulse" class="layer pulse" playsinline muted loop preload="auto">
      <source src="./assets/start/pulse.webm" type="video/webm"/>
    </video>

    <button id="cta" class="cta" type="button">Tap to Start</button>
  </main>

  <script>
    const html  = document.documentElement;
    const intro = document.getElementById('intro');
    const fire = document.getElementById('fire');
    const smoke = document.getElementById('smoke');
    const rays  = document.getElementById('rays');
    const pulse = document.getElementById('pulse');
    const cta   = document.getElementById('cta');

    // Start intro immediately (muted + playsinline allows autoplay on iOS)
    intro.currentTime = 0;
    intro.play().catch(()=>{});

    // When intro ends, start loops in sync and reveal CTA
    intro.addEventListener('ended', () => {
      [fire, smoke, rays, pulse].forEach(v => { v.currentTime = 0; v.play().catch(()=>{}); });
      html.classList.add('ready');
    }, { once:true });

    // Tap to proceed -> fade button, then go to auth.html (preserves ?invite=CODE)
    cta.addEventListener('click', () => {
      cta.classList.add('leaving');
      const qs = window.location.search || '';  // preserve query string
      // keep overlays running while navigating
      setTimeout(() => { window.location.href = 'auth.html' + qs; }, 260);
    });
  </script>
</body>
</html>
